#!/bin/bash

: "${CONSOLE_IN_NAMED_PIPE:=/var/run/bds-stdin}"

if [ $# = 0 ]; then
  echo "ERROR: pass console commands as arguments"
  exit 1
fi

if [ ! -p "${CONSOLE_IN_NAMED_PIPE}" ]; then
  echo "ERROR: named pipe ${CONSOLE_IN_NAMED_PIPE} is missing"
  exit 1
fi

/usr/local/bin/entrypoint-demoter --match /data bash -c "echo $* > '${CONSOLE_IN_NAMED_PIPE}'"